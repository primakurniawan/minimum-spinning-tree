<!DOCTYPE html>
<html>

<head>
  <!-- START SIGMA IMPORTS -->
  <script src="./sigma.js/sigma.core.js"></script>
  <script src="./sigma.js/conrad.js"></script>
  <script src="./sigma.js/utils/sigma.utils.js"></script>
  <script src="./sigma.js/utils/sigma.polyfills.js"></script>
  <script src="./sigma.js/sigma.settings.js"></script>
  <script src="./sigma.js/classes/sigma.classes.dispatcher.js"></script>
  <script src="./sigma.js/classes/sigma.classes.configurable.js"></script>
  <script src="./sigma.js/classes/sigma.classes.graph.js"></script>
  <script src="./sigma.js/classes/sigma.classes.camera.js"></script>
  <script src="./sigma.js/classes/sigma.classes.quad.js"></script>
  <script src="./sigma.js/classes/sigma.classes.edgequad.js"></script>
  <script src="./sigma.js/captors/sigma.captors.mouse.js"></script>
  <script src="./sigma.js/captors/sigma.captors.touch.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.canvas.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.webgl.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.svg.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.def.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.nodes.def.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.edges.def.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.edges.fast.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.labels.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.hovers.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.nodes.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.curve.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.extremities.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.utils.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.nodes.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.edges.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.edges.curve.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.labels.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.hovers.def.js"></script>
  <script src="./sigma.js/middlewares/sigma.middlewares.rescale.js"></script>
  <script src="./sigma.js/middlewares/sigma.middlewares.copy.js"></script>
  <script src="./sigma.js/misc/sigma.misc.animation.js"></script>
  <script src="./sigma.js/misc/sigma.misc.bindEvents.js"></script>
  <script src="./sigma.js/misc/sigma.misc.bindDOMEvents.js"></script>
  <script src="./sigma.js/misc/sigma.misc.drawHovers.js"></script>
  <script src="./sigma.js/utils/sigma.utils.js"></script>
  <script src="./sigma.js/utils/sigma.polyfills.js"></script>
  <script src="./sigma.js/sigma.settings.js"></script>
  <script src="./sigma.js/classes/sigma.classes.dispatcher.js"></script>
  <script src="./sigma.js/classes/sigma.classes.configurable.js"></script>
  <script src="./sigma.js/classes/sigma.classes.graph.js"></script>
  <script src="./sigma.js/classes/sigma.classes.camera.js"></script>
  <script src="./sigma.js/classes/sigma.classes.quad.js"></script>
  <script src="./sigma.js/classes/sigma.classes.edgequad.js"></script>
  <script src="./sigma.js/captors/sigma.captors.mouse.js"></script>
  <script src="./sigma.js/captors/sigma.captors.touch.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.canvas.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.webgl.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.svg.js"></script>
  <script src="./sigma.js/renderers/sigma.renderers.def.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.nodes.def.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.edges.def.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.edges.fast.js"></script>
  <script src="./sigma.js/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.labels.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.hovers.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.nodes.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.curve.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
  <script src="./sigma.js/renderers/canvas/sigma.canvas.extremities.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.utils.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.nodes.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.edges.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.edges.curve.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.labels.def.js"></script>
  <script src="./sigma.js/renderers/svg/sigma.svg.hovers.def.js"></script>
  <script src="./sigma.js/middlewares/sigma.middlewares.rescale.js"></script>
  <script src="./sigma.js/middlewares/sigma.middlewares.copy.js"></script>
  <script src="./sigma.js/misc/sigma.misc.animation.js"></script>
  <script src="./sigma.js/misc/sigma.misc.bindEvents.js"></script>
  <script src="./sigma.js/misc/sigma.misc.bindDOMEvents.js"></script>
  <script src="./sigma.js/misc/sigma.misc.drawHovers.js"></script>
  <script src="./sigma.js/plugins/sigma.renderers.edgeLabels/settings.js"></script>
  <script src="./sigma.js/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.def.js"></script>
  <script src="./sigma.js/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curve.js"></script>
  <script src="./sigma.js/plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curvedArrow.js"></script>
  <style>
    #container {
      max-width: 1140px;
      width: 90%;
      margin: auto;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
    }

    #top {
      flex-basis: 100%;
    }

    #bottom_left {
      flex-basis: 25%;
    }

    #bottom_right {
      flex-basis: 70%;
    }

    #originalGraph,
    #mstResultGraph {
      height: 50vh;
      width: 100%;
    }

    /* #graph-container {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      position: absolute;
      margin: auto;
      height: 100vh;
    } */
    .mstGraph {
      width: 100%;
      height: 25vh;
    }
  </style>
</head>

<body>
<h1 style="text-align: center;">Minimum Spinning Tree</h1>
  <div id="container">
    <div id="top">
      <form id="addEdge">
        <input type="text" name="src" id="src" placeholder="src" />
        <input type="text" name="target" id="target" placeholder="target" />
        <input type="number" name="weight" id="weight" placeholder="weight" />
        <input type="submit" value="add edge" />
      </form>
      <button id="reset">Reset</button>
      <button id="runMST">Run Minimum Spinning Tree</button>
    </div>
    <div id="bottom_left"></div>
    <div id="bottom_right">
      <div id="originalGraph"></div>
      <div id="mstResultGraph"></div>
    </div>
  </div>
  </div>
  <script src="./dist/main.js"></script>
  <script>
    const dom = () => {
      return {
        addEdge: document.getElementById("addEdge"),
        src: document.getElementById("src"),
        target: document.getElementById("target"),
        weight: document.getElementById("weight"),
        runMST: document.getElementById("runMST"),
        reset: document.getElementById("reset"),
        Top: document.getElementById("top"),
        bottomRight: document.getElementById("bottom_right"),
        bottomLeft: document.getElementById("bottom_left"),
        originalGraph: document.getElementById("originalGraph"),
        mstResultGraph: document.getElementById("mstResultGraph"),
        originalTitle: document.getElementById("originalTitle"),
      };
    };

    dom().addEdge.addEventListener('submit', e => {
      dom().originalGraph.innerHTML = '';
      const graph = JSON.parse(localStorage.getItem('globalGraph'));
      if (dom().originalTitle) {
        dom().originalGraph.insertAdjacentHTML('beforebegin','<h2 id="originalTitle" style="text-align:center;">Original Graph</h2>')
      } 
      renderGraph(graph, 'originalGraph')
    })

    dom().runMST.addEventListener('click', (e) => {
      dom().Top.innerHTML = `<button id='reset'>Create another graph</button>`;
      dom().bottomLeft.innerHTML = '';
      var s,
        o,
        L = 10,
        g = {
          nodes: [],
          edges: [],
        };
      const mstGraph = JSON.parse(localStorage.getItem('mstGraph'));
      mstGraph.forEach((e, i) => {
        const del = e.connect ? 'dapat dihapus' : "tidak dapat di hapus";
        const strEl = `<h3 style="background:${e.connect ? 'green':'red'}; text-align:center;color:white;">${e.edge.src}${e.edge.target} ${del}</h3>
        <div id="mstGraph-${i}" class="mstGraph"></div>`;
        dom().bottomLeft.insertAdjacentHTML('beforeend', strEl);
        renderGraph(e.graph, 'mstGraph-' + i);
      })
      const mstResultGraph = mstGraph.filter(e => e.connect)[mstGraph.filter(e => e.connect).length - 1].graph;
      dom().mstResultGraph.insertAdjacentHTML('beforebegin', '<h2 style="text-align:center;">MST Result Graph</h2>')
      renderGraph(mstResultGraph, 'mstResultGraph');
      const edgesMst = mstGraph.filter(e => !e.connect).map(e => e.edge);
      let str = '';
      let total = 0;
      edgesMst.forEach(({
        src,
        target,
        weight
      }) => {
        str += `${src}${target} (${weight}) + `;
        total += weight;
      })
      str = str.slice(0, -2);
      dom().mstResultGraph.insertAdjacentHTML('afterend', `<h3 style="text-align:center;">${str}=${total}</h3>`)

      console.log(edgesMst)
    })

    const renderGraph = (graph, container) => {
      var s,
        o,
        L = 10,
        g = {
          nodes: [],
          edges: [],
        };
      const nodes = graph.nodes;
      const edges = graph.edges;
      nodes.forEach((e, i) => {
        o = {
          id: e,
          label: e,
          x: L * Math.cos((Math.PI * 2 * i) / nodes.length - Math.PI / 2),
          y: L * Math.sin((Math.PI * 2 * i) / nodes.length - Math.PI / 2),
          size: 1,
          color: "#" +
            (Math.floor(Math.random() * 16777215).toString(16) + "000000").substr(
              0,
              6
            ),
        };
        g.nodes.push(o);

        edges.forEach((e, i) => {
          g.edges.push({
            id: i,
            label: '' + e.weight,
            source: e.src,
            target: e.target,
            size: 1,
            color: '#ccc',
          })
        })
      })

      s = new sigma({
        graph: g,
        renderer: {
          container: document.getElementById(container),
          type: 'canvas'
        },
        settings: {
          edgeLabelSize: 'proportional',
          mouseEnabled: false
        }
      });
      g.nodes = []
      g.edges = []
    }

  </script>
</body>

</html>